<!DOCTYPE html>
<html>
  <head>
    <title>Yodiwo SDK &amp; API Documentation</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="generator" content="Hugo 0.34" />
<title>Pairing Overview :: Yodiwo SDK &amp; API Documentation</title>
<link rel="shortcut icon" href="/doc/images/favicon.png" type="image/x-icon" />
<link href="/doc/css/font-awesome.min.css" rel="stylesheet">
<link href="/doc/css/nucleus.css" rel="stylesheet">
<link href="/doc/theme-flex/style.css" rel="stylesheet">

<link rel="stylesheet" href="/doc/css/bootstrap.min.css">
<script src="/doc/js/jquery-2.x.min.js"></script>
<script type="text/javascript">
      var baseurl = "https:\/\/docs.yodiwo.com\/doc\/";
</script>

<style>
div.code-tabs {
  position: relative;
  margin-top: -1px;
  z-index: 10;
  margin-bottom: -20px;
}

div.tab {
  font-size: 13px;
  display: inline-block;
  font-weight: 300;
}

.tab.on a {
  color: #009999;
}

.tab.off a {
  color: grey;
}
</style>
<script>
    function showCode(codeContainer, language) {
        var container = document.getElementById(codeContainer);
        var codes = container.getElementsByTagName('pre');
        for (var i = 0; i < codes.length; i++) {
            codes[i].style.display = 'none';
            if (codes[i].id == language) {
                codes[i].style.display = '';
            }
        }

        var tabs = container.getElementsByClassName('tab');
        for (var i = 0; i < tabs.length; i++) {
            tabs[i].className = "tab off";
            if (tabs[i].getAttribute("data-lang") == language) {
                tabs[i].className = 'tab on';
            }
        }
    }
</script>


<style>
.main {
min-height: calc(100vh - 40px);
}
</style>


<style>

.my-float{
        position:fixed;
        width:50px;
        height:45px;
        bottom:20px;
        right:40px;
        background-color: #012a3c;
        color:#FFF;
        border-radius: 60px;
        text-align: center;
        box-shadow: 2px 2px 3px #999;
        font-weight: bold;
        opacity: 0.45;
        font-size: 30px;
        margin-top:30px;
}


.my-float:hover {
        background-color: #012a3c;
        opacity: 0.8;
        color: white;
}

</style>


<style>
h4 {
padding-top: 71px;
}
</style>

    
  </head>
  <body data-url="/doc/apis/plegma/pairing-overview/">
    
      <header>
  <div class="logo">
    
	
  
    <p><a id="logo" href="/">
<img src="/assets/images/logo.png" alt="Yodiwo">
</a></p>

  

  </div>
  <div class="burger"><a href="javascript:void(0);" style="font-size:15px;">&#9776;</a></div>
    <nav class="shortcuts">
            <li class="" role="">
                <a href="https://www.yodiwo.com" target="_blank" rel="noopener">
                  <i class='fa fa-globe'></i> <label>Yodiwo</label>
                </a>
            </li>
            <li class="" role="">
                <a href="https://tcyan.yodiwo.com" target="_blank" rel="noopener">
                  <i class='fa fa-cloud'></i> <label>Cyan</label>
                </a>
            </li>
            <li class="" role="">
                <a href="https://github.com/yodiwo" target="_blank" rel="noopener">
                  <i class='fa fa-github'></i> <label>Github repo</label>
                </a>
            </li>
            <li class="" role="">
                <a href="https://discuss.yodiwo.com" target="_blank" rel="noopener">
                  <i class='fa fa-comments'></i> <label>Community</label>
                </a>
            </li>
    </nav>
</header>
<article>
  <aside>
    <ul class="menu">
          <li data-nav-id="/doc/" class="dd-item">
          <a href="/doc/">
            <i class="fa fa-fw fa-home"></i>
          </a>
          </li>
    <li data-nav-id="/doc/platform/" class="dd-item haschildren
        ">
      <div>
      <a href="/doc/platform/">Platform</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/doc/platform/interconnection-concepts-and-topology/" class="dd-item">
        <div>
          <a href="/doc/platform/interconnection-concepts-and-topology/">
            Interconnection Concepts and Topology
          </a>
        </div></li>
      <li data-nav-id="/doc/platform/apis/" class="dd-item">
        <div>
          <a href="/doc/platform/apis/">
            APIs
          </a>
        </div></li>
      <li data-nav-id="/doc/platform/yodiwo-fog-gateway/" class="dd-item">
        <div>
          <a href="/doc/platform/yodiwo-fog-gateway/">
            Yodiwo Fog Gateway
          </a>
        </div></li>
        </ul>
    </li>
    <li data-nav-id="/doc/wisper/" class="dd-item haschildren
        ">
      <div>
      <a href="/doc/wisper/">Wisper</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/doc/wisper/yodiwo-wisper/" class="dd-item">
        <div>
          <a href="/doc/wisper/yodiwo-wisper/">
            Yodiwo Wisper
          </a>
        </div></li>
    <li data-nav-id="/doc/wisper/wisper-families/" class="dd-item haschildren
        ">
      <div>
      <a href="/doc/wisper/wisper-families/">Wisper Families</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/doc/wisper/wisper-families/wisper-pro/" class="dd-item">
        <div>
          <a href="/doc/wisper/wisper-families/wisper-pro/">
            Wisper Pro
          </a>
        </div></li>
        </ul>
    </li>
        </ul>
    </li>
    <li data-nav-id="/doc/apis/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/doc/apis/">Yodiwo APIs</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/doc/apis/plegma/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/doc/apis/plegma/">Plegma</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/doc/apis/plegma/getting-started/" class="dd-item">
        <div>
          <a href="/doc/apis/plegma/getting-started/">
            Getting Started
          </a>
        </div></li>
      <li data-nav-id="/doc/apis/plegma/pairing-overview/" class="dd-item active">
        <div>
          <a href="/doc/apis/plegma/pairing-overview/">
            Pairing Overview
          </a>
        </div> 
<ul>

<li class="dd-item"> 






<a href="#nodes-without-a-gui">Nodes without a GUI</a>
</li>

<li class="dd-item"> 






<a href="#nodes-with-a-gui">Nodes with a GUI</a>
</li>

</ul>

 </li>
    <li data-nav-id="/doc/apis/plegma/messages/" class="dd-item haschildren
        ">
      <div>
      <a href="/doc/apis/plegma/messages/">API Messages</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/doc/apis/plegma/messages/api-overview/" class="dd-item">
        <div>
          <a href="/doc/apis/plegma/messages/api-overview/">
            API Overview
          </a>
        </div></li>
      <li data-nav-id="/doc/apis/plegma/messages/base-api-message-class/" class="dd-item">
        <div>
          <a href="/doc/apis/plegma/messages/base-api-message-class/">
            Base API message class
          </a>
        </div></li>
      <li data-nav-id="/doc/apis/plegma/messages/things-ports/" class="dd-item">
        <div>
          <a href="/doc/apis/plegma/messages/things-ports/">
            Things &amp; Ports
          </a>
        </div></li>
      <li data-nav-id="/doc/apis/plegma/messages/things-mgmt-ctrl/" class="dd-item">
        <div>
          <a href="/doc/apis/plegma/messages/things-mgmt-ctrl/">
            Things management &amp; control
          </a>
        </div></li>
      <li data-nav-id="/doc/apis/plegma/messages/message-event-passing/" class="dd-item">
        <div>
          <a href="/doc/apis/plegma/messages/message-event-passing/">
            Message &amp; event passing
          </a>
        </div></li>
        </ul>
    </li>
    <li data-nav-id="/doc/apis/plegma/rest/" class="dd-item haschildren
        ">
      <div>
      <a href="/doc/apis/plegma/rest/">Rest API</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/doc/apis/plegma/rest/rest-api/" class="dd-item">
        <div>
          <a href="/doc/apis/plegma/rest/rest-api/">
            Get available routes
          </a>
        </div></li>
      <li data-nav-id="/doc/apis/plegma/rest/rest-api-things-get/" class="dd-item">
        <div>
          <a href="/doc/apis/plegma/rest/rest-api-things-get/">
            Get Things
          </a>
        </div></li>
      <li data-nav-id="/doc/apis/plegma/rest/rest-api-things-set/" class="dd-item">
        <div>
          <a href="/doc/apis/plegma/rest/rest-api-things-set/">
            Set Things
          </a>
        </div></li>
      <li data-nav-id="/doc/apis/plegma/rest/rest-api-events/" class="dd-item">
        <div>
          <a href="/doc/apis/plegma/rest/rest-api-events/">
            Post events
          </a>
        </div></li>
      <li data-nav-id="/doc/apis/plegma/rest/rest-api-port-states-request/" class="dd-item">
        <div>
          <a href="/doc/apis/plegma/rest/rest-api-port-states-request/">
            Sync with server&#39;s Port States
          </a>
        </div></li>
        </ul>
    </li>
    <li data-nav-id="/doc/apis/plegma/mqtt/" class="dd-item haschildren
        ">
      <div>
      <a href="/doc/apis/plegma/mqtt/">MQTT</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/doc/apis/plegma/mqtt/mqtt-overview/" class="dd-item">
        <div>
          <a href="/doc/apis/plegma/mqtt/mqtt-overview/">
            MQTT support
          </a>
        </div></li>
      <li data-nav-id="/doc/apis/plegma/mqtt/message-format/" class="dd-item">
        <div>
          <a href="/doc/apis/plegma/mqtt/message-format/">
            Message format
          </a>
        </div></li>
        </ul>
    </li>
      <li data-nav-id="/doc/apis/plegma/websockets-overview/" class="dd-item">
        <div>
          <a href="/doc/apis/plegma/websockets-overview/">
            Web Sockets Overview
          </a>
        </div></li>
        </ul>
    </li>
        </ul>
    </li>
    <li data-nav-id="/doc/integrators/" class="dd-item haschildren
        ">
      <div>
      <a href="/doc/integrators/">Integrators</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/doc/integrators/direct-connection/" class="dd-item haschildren
        ">
      <div>
      <a href="/doc/integrators/direct-connection/">Direct Connection to Alcyone</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/doc/integrators/direct-connection/using-restful-http-requests/" class="dd-item">
        <div>
          <a href="/doc/integrators/direct-connection/using-restful-http-requests/">
            Using RESTful HTTP requests
          </a>
        </div></li>
      <li data-nav-id="/doc/integrators/direct-connection/using-3rd-party-mqtt-brokers/" class="dd-item">
        <div>
          <a href="/doc/integrators/direct-connection/using-3rd-party-mqtt-brokers/">
            Using 3rd party MQTT brokers
          </a>
        </div></li>
        </ul>
    </li>
    <li data-nav-id="/doc/integrators/connection-via-plegma-api/" class="dd-item haschildren
        ">
      <div>
      <a href="/doc/integrators/connection-via-plegma-api/">Via the Plegma API</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/doc/integrators/connection-via-plegma-api/plegma-nodes-credentials/" class="dd-item">
        <div>
          <a href="/doc/integrators/connection-via-plegma-api/plegma-nodes-credentials/">
            Plegma Nodes Credentials
          </a>
        </div></li>
      <li data-nav-id="/doc/integrators/connection-via-plegma-api/plegma-things-creation-and-handling/" class="dd-item">
        <div>
          <a href="/doc/integrators/connection-via-plegma-api/plegma-things-creation-and-handling/">
            Plegma Things Creation and Handling
          </a>
        </div></li>
        </ul>
    </li>
        </ul>
    </li>




    </ul>
    <section>
    </section>
  </aside>
  <section class="page">
    
    <div class="nav-select">
      <center>Navigation : 
        <select onchange="javascript:location.href = this.value;">
          
    <option value="/doc/platform/" >
   Platform</option>
    <option value="/doc/wisper/" >
   Wisper</option>
    <option value="/doc/apis/" >
   Yodiwo APIs</option> 
    <option value="/doc/apis/plegma/" >
  - 
   Plegma</option> 
      <option value="/doc/apis/plegma/getting-started/" >-- Getting Started</option>
      <option value="/doc/apis/plegma/pairing-overview/"  selected>-- Pairing Overview</option>
    <option value="/doc/apis/plegma/messages/" >
  -- 
   API Messages</option>
    <option value="/doc/apis/plegma/rest/" >
  -- 
   Rest API</option>
    <option value="/doc/apis/plegma/mqtt/" >
  -- 
   MQTT</option>
      <option value="/doc/apis/plegma/websockets-overview/" >-- Web Sockets Overview</option>
  
  
    <option value="/doc/integrators/" >
   Integrators</option>



        </select>
      </center>
    </div>
      <div>
        <div class="searchbox">
          <input data-search-input id="search-by" type="text" placeholder="Search...">
        </div>
        <script type="text/javascript" src="/doc/js/lunr.min.js"></script>
        <script type="text/javascript" src="/doc/js/auto-complete.js"></script>
        <link href="/doc/css/auto-complete.css" rel="stylesheet">
        <script type="text/javascript">
          
              var baseurl = "https:\/\/docs.yodiwo.com\/doc\/";
          
        </script>
        <script type="text/javascript" src="/doc/js/search.js"></script>
      </div>
    

    <h1>Pairing Overview</h1>
    
    
    
    

<p>All Nodes need to go through a “pairing” process in order for them to be allowed to exchange data with the Yodiwo cloud. This process is also known as Provisioning or Commissioning.</p>

<p>Pairing assigns a Key and a secret token to the node, both of which are used to later establish connections to the Yodiwo Cloud Platform over secure channels.</p>

<p>The pairing process is defined for two classes of Node devices, those that do not have a GUI of their own and those that do. The process for both is similar. Complete, verified, reference implementations are provided for both by Yodiwo; check relevant examples for your preferred language on <a href="https://github.com/yodiwo/plegma">GitHub</a>.</p>

<h4 id="nodes-without-a-gui">Nodes without a GUI</h4>

<p>These nodes do not have a screen of their own or other means of projecting to a screen. They are also assumed to be not powerful enough to implement a secure HTTPS web server, but are capable of acting as a client to a secure server, as that is a fundamental requirement for a Node of Yodiwo&rsquo;s Platform.</p>

<p>Hence the method needs the device to:</p>

<ol>
<li>become discoverable (via some form of service discovery if Ethernet, SoftAP if WiFi, visible if Bluetooth, etc)</li>
<li>implement and start a simple HTTP server (not necessarily secure), or just be able to respond to 2 basic GET requests</li>
<li>be able to access a secure HTTPS server as a client</li>
</ol>

<p>From these basic requirements a pairing process is devised that allows the node to only be paired with the Yodiwo account of its owner, even if the non-secure part of the communication is eavesdropped. In the latter case, if the attacker tries to hijack the node and pair it to their own account, the node is guaranteed to not be paired at all; the rightful owner (i.e. the one who has physical access to the device and its UUID) is informed via their Yodiwo account.</p>

<p>At the start of the procedure, the user is instructed to find and connect (if necessary by its physical interface) to the device, then visit its web page at http://&lt;deviceip&gt;/pairing/start where they will be instructed to follow the instructions for pairing, which is a simple 2-step process.
The technical details of this process is seen in the following sequence diagram, and as mentioned, code for it in most major languages (C, Java, JS, Objective-C, C#) is provided by Yodiwo at <a href="https://github.com/yodiwo/plegma">GitHub</a>.</p>

<p>The following sequence diagram describes the pairing procedure in detail:</p>

<p><img src="/assets/images/yodi-tech-doc-pairing_v2.0.png" alt="Alt Sequence diagram of secure pairing of a GUIless node" />
<center><figcaption>Sequence diagram of secure pairing of a GUIless node</figcaption></center></p>

<p>Upon receiving a pairing request (an HTTP Request for &lt;deviceid&gt;/pairing/start) the Node (without yet sending a Response) securely (over an SSL/TLS channel) sends capabilities, configuration and its UUID to the Cloud Server. The cloud server generates two tokens and a secret key and securely sends the 2 tokens (but not the secret key) back to the Node.</p>

<p>As a Response to the original pairing request, the node then:</p>

<p>redirects the User’s browser to the Yodiwo Server so that they securely login and authenticate with Yodiwo, and
sends Token2 as a parameter (?token2=&lt;token&gt;)
It must be noted that this action happens over a non SSL/TLS secured channel (even a strongly encrypted Wi-Fi link is not considered end-to-end secure) and hence an eavesdropper may have acquired Token2. It is therefore important to make sure that such a case cannot lead to a faux-pairing and the hijacking of a legitimate user’s device.
The Node’s response redirects the User’s browser to the Yodiwo cloud service pairing page. If they are not already logged in, they are required to securely log in to their Yodiwo account (via redirection). After successful login they are automatically taken back to the pairing page where they enter the Node’s UUID. This step can also be completed without manual entry, e.g. via NFC or QR code sent from an already paired device such as a smartphone.
Afterwards the browser triggers the node to complete the pairing process at which point the node securely sends Token1 to the Cloud Service.</p>

<p>At this point the Cloud Server evaluates that:</p>

<ul>
<li>securely received Tokens 1 and 2 are the same as the ones it originally generated; an attacker may also know Token 2 but they cannot send it to Yodiwo without being a registered user.</li>
<li>UUID received securely by the logged in User is the same as the one originally securely sent by the Node. Even an attacker who is a registered Yodiwo user can only know Token2, not the Node’s UUID since the latter requires physical access to it.</li>
</ul>

<p>If everything is in order, the Server securely sends the Node Key and Secret API Key to the Node. These must be used for all Node &lt;-&gt; Server communication from now on, which as previously mentioned, is mandated to occur over a secure channel.</p>

<div class="panel panel-info">
	<div class="panel-heading"><i class="fa fa-info-circle" aria-hidden="true"></i>&ensp;Notes</div>
	<div class="panel-body"><ul>

<li>Since all these steps are done with redirects the user never actually has to type any addresses after the initial http://&lt;deviceid&gt;/ one (which also may be avoided via Service Discovery)</li>

 <li>The user may manually enter their Node’s UUID, although manual entry can be avoided through the use of QR codes (no external applications needed, modern browsers –desktop and mobile- allow this)</li> <li>Recap: even if Token2 is acquired by an attacker, pairing cannot be successfully completed without:<ul> <li>A valid login to the Yodiwo Service</li><li>Physical access to the newly acquired Node to read / scan its UUID<br>A Node hijacking attempt will fail and the legitimate user will be notified (through their account)</li>

​        </ul>
​        </li>
​    </ul> 
</div>
	
</div>


<h4 id="nodes-with-a-gui">Nodes with a GUI</h4>

<hr />

<p>The main difference is that GUIful nodes usually shed the limitation of having a 3rd party GUI (e.g. a browser web page) act as mediator and communicate insecurely with the node and securely with the Yodiwo servers.
Hence they could in theory POST a start pairing request with configuration, get redirected to log in to the Yodiwo service and then immediately exchange Node and Secret keys. Currently these nodes still exchange tokens and the pairing backend in Yodiwo servers remains the same, resulting in the following sequence diagram:</p>

<p><img src="/assets/images/yodi-tech-doc-pairing_v2.0_withgui.png" alt="Alt Sequence diagram of secure pairing for a Node with a GUI" />
<center><figcaption>Sequence diagram of secure pairing for a Node with a GUI</figcaption></center></p>


    
    
        <div class="chevrons">
    <div id="navigation">
<a class="nav nav-prev" href="/doc/apis/plegma/getting-started/" title="Getting Started"> <i class="fa fa-chevron-left"></i><label>Getting Started</label></a>
    <a class="nav nav-next" href="/doc/apis/plegma/messages/" title="API Messages" style="margin-right: 0px;"><label>API Messages</label><i class="fa fa-chevron-right"></i></a></div>
  </div>

  </section>
</article>

<footer>

<div class="footline">
    

    

  
    <div class="date">
        <i class='fa fa-calendar'></i> Last update on 23/01/2018
    </div>
    

    <div class="github-link">
      <a href="https://github.com/yodiwo/doc/edit/master/content/apis/plegma/pairing_overview.md" target="blank"><i class="fa fa-code-fork"></i>
        Improve this page</a>
    </div>
  </div>


	<div>


  
    <p><center> Contact us at : info@yodiwo.com </center></p>

  



	</div>
</footer>

<script src="/doc/js/clipboard.min.js"></script>

<link href="/doc/css/featherlight.min.css" rel="stylesheet">
<script src="/doc/js/featherlight.min.js"></script>



<script src="/doc/theme-flex/script.js"></script>

    

    
    

    
  </body>
</html>